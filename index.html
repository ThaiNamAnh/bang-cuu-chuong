<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>√în t·∫≠p B·∫£ng C·ª≠u Ch∆∞∆°ng</title>
        <!-- S·ª≠ d·ª•ng Tailwind CSS ƒë·ªÉ giao di·ªán ƒë·∫πp h∆°n -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- S·ª≠ d·ª•ng Google Fonts cho font ch·ªØ th√¢n thi·ªán -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <style>
            /* T√πy ch·ªânh font ch·ªØ cho to√†n b·ªô trang */
            body {
                font-family: "Baloo 2", cursive;
            }
            /* Hi·ªáu ·ª©ng khi di chu·ªôt v√†o n√∫t */
            .btn-hover:hover {
                transform: scale(1.05);
            }
            /* Ki·ªÉu cho input */
            .answer-input {
                transition: border-color 0.3s, background-color 0.3s, color 0.3s;
            }
            /* Ki·ªÉu cho c√¢u tr·∫£ l·ªùi ƒê√öNG */
            .correct {
                border-color: #16a34a; /* green-600 */
                background-color: #dcfce7; /* green-100 */
                color: #15803d; /* green-700 */
                font-weight: bold;
            }
            /* Ki·ªÉu cho c√¢u tr·∫£ l·ªùi SAI */
            .incorrect {
                border-color: #dc2626; /* red-600 */
                background-color: #fee2e2; /* red-100 */
                color: #b91c1c; /* red-700 */
                font-weight: bold;
            }
            /* Ki·ªÉu cho icon ph·∫£n h·ªìi (d·∫•u tick v√† d·∫•u ch√©o) */
            .feedback-icon {
                font-size: 1.75rem; /* TƒÉng k√≠ch th∆∞·ªõc icon */
                font-weight: bold;
                line-height: 1;
                width: 2rem; /* D√†nh kh√¥ng gian cho icon */
                display: inline-flex;
                align-items: center;
                justify-content: center;
                margin-left: 0.5rem;
            }
            .icon-correct {
                color: #16a34a; /* green-600 */
            }
            .icon-incorrect {
                color: #dc2626; /* red-600 */
            }
            /* NgƒÉn ng∆∞·ªùi d√πng ch·ªçn vƒÉn b·∫£n tr√™n c√°c n√∫t modal */
            .modal-button {
                user-select: none;
            }
        </style>
    </head>
    <body class="bg-blue-50 flex items-center justify-center min-h-screen p-4">
        <div
            class="w-full max-w-6xl mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-8 text-center border-4 border-purple-400"
        >
            <!-- Ti√™u ƒë·ªÅ -->
            <h1 class="text-3xl md:text-4xl font-bold text-purple-600 mb-2">
                B√© Vui H·ªçc To√°n
            </h1>
            <p class="text-gray-500 mb-6">
                H√£y ho√†n th√†nh c√°c ph√©p t√≠nh d∆∞·ªõi ƒë√¢y nh√©!
            </p>

            <!-- B·ªô l·ªçc ch·ªçn b·∫£ng c·ª≠u ch∆∞∆°ng -->
            <div
                class="mb-6 flex flex-col sm:flex-row items-center justify-center gap-2"
            >
                <label
                    for="table-select"
                    class="text-xl font-semibold text-gray-700"
                    >Ch·ªçn b·∫£ng c·ª≠u ch∆∞∆°ng:</label
                >
                <select
                    id="table-select"
                    class="text-lg p-2 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:ring-purple-500"
                >
                    <option value="1">B·∫£ng 1</option>
                    <option value="2">B·∫£ng 2</option>
                    <option value="3" selected>B·∫£ng 3</option>
                    <option value="4">B·∫£ng 4</option>
                    <option value="5">B·∫£ng 5</option>
                    <option value="6">B·∫£ng 6</option>
                    <option value="7">B·∫£ng 7</option>
                    <option value="8">B·∫£ng 8</option>
                    <option value="9">B·∫£ng 9</option>
                </select>
            </div>

            <!-- Khu v·ª±c hi·ªÉn th·ªã c√°c ph√©p to√°n (responsive) -->
            <div
                id="problems-grid"
                class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4 my-6"
            >
                <!-- C√°c b√†i to√°n s·∫Ω ƒë∆∞·ª£c t·∫°o ·ªü ƒë√¢y -->
            </div>

            <!-- C√°c n√∫t h√†nh ƒë·ªông -->
            <div
                class="flex flex-col sm:flex-row items-center justify-center gap-4"
            >
                <button
                    id="check-btn"
                    class="w-full sm:w-auto bg-green-500 text-white font-bold text-xl px-8 py-4 rounded-lg shadow-md transition-transform duration-200 btn-hover"
                >
                    Ki·ªÉm tra k·∫øt qu·∫£
                </button>
                <button
                    id="new-problems-btn"
                    class="w-full sm:w-auto bg-purple-500 text-white font-bold text-xl px-8 py-4 rounded-lg shadow-md transition-transform duration-200 btn-hover"
                >
                    L√†m b√†i m·ªõi
                </button>
            </div>

            <!-- Khu v·ª±c hi·ªÉn th·ªã th√¥ng b√°o -->
            <div class="mt-6">
                <div
                    id="message"
                    class="h-10 text-2xl font-semibold transition-all duration-300"
                ></div>
            </div>
        </div>

        <!-- Modal (popup) cho vi·ªác ch·ªçn ƒë√°p √°n tr√™n di ƒë·ªông -->
        <div
            id="choice-modal"
            class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50"
        >
            <div
                class="bg-white rounded-2xl shadow-2xl p-6 text-center w-full max-w-xs"
            >
                <!-- Ti√™u ƒë·ªÅ c·ªßa modal gi·ªù s·∫Ω hi·ªÉn th·ªã ph√©p t√≠nh -->
                <h2
                    id="modal-question"
                    class="text-3xl font-bold text-purple-600 mb-6"
                ></h2>
                <div id="choice-buttons" class="grid grid-cols-2 gap-4">
                    <!-- C√°c n√∫t ch·ªçn ƒë√°p √°n s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y b·∫±ng JavaScript -->
                </div>
            </div>
        </div>

        <script>
            // L·∫•y c√°c ph·∫ßn t·ª≠ HTML c·∫ßn thi·∫øt
            const tableSelect = document.getElementById("table-select");
            const problemsGrid = document.getElementById("problems-grid");
            const checkBtn = document.getElementById("check-btn");
            const newProblemsBtn = document.getElementById("new-problems-btn");
            const messageEl = document.getElementById("message");
            const choiceModal = document.getElementById("choice-modal");
            const choiceButtonsContainer =
                document.getElementById("choice-buttons");
            const modalQuestionEl = document.getElementById("modal-question");

            const NUM_PROBLEMS = 15;
            let problems = [];

            /**
             * Ki·ªÉm tra xem thi·∫øt b·ªã c√≥ ph·∫£i l√† di ƒë·ªông hay kh√¥ng.
             * @returns {boolean} True n·∫øu l√† di ƒë·ªông, ng∆∞·ª£c l·∫°i l√† false.
             */
            function isMobile() {
                return window.innerWidth < 768;
            }

            /**
             * T·∫°o m·ªôt b·ªô b√†i to√°n m·ªõi v√† hi·ªÉn th·ªã l√™n m√†n h√¨nh, ƒë·∫£m b·∫£o kh√¥ng c√≥ ph√©p t√≠nh tr√πng l·∫∑p.
             */
            function generateProblems() {
                const selectedTable = parseInt(tableSelect.value, 10);
                problemsGrid.innerHTML = "";
                messageEl.textContent = "";

                // 1. T·∫°o m·ªôt kho ch·ª©a t·∫•t c·∫£ c√°c ph√©p t√≠nh c√≥ th·ªÉ c√≥ (10 nh√¢n, 10 chia)
                const problemPool = [];
                for (let i = 1; i <= 10; i++) {
                    // Ph√©p nh√¢n
                    problemPool.push({
                        question: `${selectedTable} x ${i} =`,
                        answer: selectedTable * i,
                    });
                    // Ph√©p chia
                    problemPool.push({
                        question: `${selectedTable * i} √∑ ${selectedTable} =`,
                        answer: i,
                    });
                }

                // 2. X√°o tr·ªôn ng·∫´u nhi√™n kho ph√©p t√≠nh (thu·∫≠t to√°n Fisher-Yates)
                for (let i = problemPool.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [problemPool[i], problemPool[j]] = [
                        problemPool[j],
                        problemPool[i],
                    ];
                }

                // 3. L·∫•y 15 ph√©p t√≠nh ƒë·∫ßu ti√™n t·ª´ kho ƒë√£ x√°o tr·ªôn
                problems = problemPool.slice(0, NUM_PROBLEMS);

                // 4. Hi·ªÉn th·ªã 15 ph√©p t√≠nh ƒë√£ ch·ªçn
                problems.forEach((problem, i) => {
                    const problemCard = document.createElement("div");
                    problemCard.className =
                        "bg-purple-50 p-4 rounded-lg shadow flex flex-col items-center justify-center";

                    problemCard.innerHTML = `
                    <p class="text-xl md:text-2xl font-bold text-gray-800 mb-2">${problem.question}</p>
                    <div class="flex items-center">
                        <input type="number" data-index="${i}" class="answer-input text-xl md:text-2xl text-center w-20 md:w-24 p-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:ring-purple-500">
                        <span class="feedback-icon"></span>
                    </div>
                `;

                    problemsGrid.appendChild(problemCard);

                    // L·∫•y th·∫ª input v·ª´a t·∫°o ƒë·ªÉ th√™m s·ª± ki·ªán
                    const inputEl = problemCard.querySelector(".answer-input");
                    if (isMobile()) {
                        // Tr√™n di ƒë·ªông: kh√¥ng cho nh·∫≠p, ch·ªâ cho click ƒë·ªÉ m·ªü modal
                        inputEl.setAttribute("readonly", true);
                        inputEl.addEventListener("click", (event) => {
                            event.preventDefault();
                            const index = parseInt(inputEl.dataset.index, 10);
                            const currentProblem = problems[index];
                            showChoiceModal(
                                inputEl,
                                currentProblem.answer,
                                currentProblem.question
                            );
                        });
                    }
                });
            }

            /**
             * Hi·ªÉn th·ªã modal v·ªõi c√°c l·ª±a ch·ªçn ƒë√°p √°n.
             * @param {HTMLElement} targetInput - √î input c·∫ßn ƒëi·ªÅn gi√° tr·ªã.
             * @param {number} correctAnswer - ƒê√°p √°n ƒë√∫ng.
             * @param {string} questionText - Ph√©p t√≠nh ƒëang ƒë∆∞·ª£c h·ªèi.
             */
            function showChoiceModal(targetInput, correctAnswer, questionText) {
                // Hi·ªÉn th·ªã ph√©p t√≠nh trong ti√™u ƒë·ªÅ c·ªßa modal
                modalQuestionEl.textContent = questionText;
                choiceButtonsContainer.innerHTML = ""; // X√≥a c√°c n√∫t c≈©

                // T·∫°o t·∫≠p h·ª£p c√°c ƒë√°p √°n, bao g·ªìm ƒë√°p √°n ƒë√∫ng v√† 3 ƒë√°p √°n sai
                const choices = new Set([correctAnswer]);
                while (choices.size < 4) {
                    const offset = Math.floor(Math.random() * 5) + 1; // T·∫°o s·ªë ng·∫´u nhi√™n t·ª´ 1-5
                    const distractor =
                        Math.random() < 0.5
                            ? correctAnswer + offset
                            : correctAnswer - offset;
                    if (distractor >= 0 && distractor !== correctAnswer) {
                        // ƒê·∫£m b·∫£o ƒë√°p √°n sai kh√°c ƒë√°p √°n ƒë√∫ng v√† kh√¥ng √¢m
                        choices.add(distractor);
                    }
                }

                // X√°o tr·ªôn c√°c ƒë√°p √°n
                const shuffledChoices = Array.from(choices).sort(
                    () => Math.random() - 0.5
                );

                // T·∫°o n√∫t cho t·ª´ng ƒë√°p √°n
                shuffledChoices.forEach((choice) => {
                    const button = document.createElement("button");
                    button.className =
                        "modal-button bg-purple-500 text-white font-bold text-2xl p-4 rounded-lg shadow-md btn-hover";
                    button.textContent = choice;
                    button.addEventListener("click", () => {
                        targetInput.value = choice;
                        choiceModal.classList.add("hidden");
                    });
                    choiceButtonsContainer.appendChild(button);
                });

                // Hi·ªÉn th·ªã modal
                choiceModal.classList.remove("hidden");
            }

            /**
             * Ki·ªÉm tra t·∫•t c·∫£ c√°c c√¢u tr·∫£ l·ªùi v√† hi·ªÉn th·ªã ph·∫£n h·ªìi.
             */
            function checkAnswers() {
                const inputs = document.querySelectorAll(".answer-input");
                let correctCount = 0;

                inputs.forEach((input) => {
                    const index = parseInt(input.dataset.index, 10);
                    const userAnswer = parseInt(input.value, 10);
                    const correctAnswer = problems[index].answer;
                    const icon = input.nextElementSibling;

                    input.classList.remove("correct", "incorrect");
                    icon.textContent = "";
                    icon.className = "feedback-icon";

                    if (!isNaN(userAnswer) && userAnswer === correctAnswer) {
                        input.classList.add("correct");
                        icon.textContent = "‚úì";
                        icon.classList.add("icon-correct");
                        correctCount++;
                    } else {
                        input.classList.add("incorrect");
                        icon.textContent = "‚úó";
                        icon.classList.add("icon-incorrect");
                    }
                });

                // Hi·ªÉn th·ªã th√¥ng b√°o k·∫øt qu·∫£ t·ªïng k·∫øt
                if (correctCount === NUM_PROBLEMS) {
                    messageEl.textContent = `Tuy·ªát v·ªùi! B·∫°n ƒë√£ ƒë√∫ng t·∫•t c·∫£ ${NUM_PROBLEMS} c√¢u! üåü`;
                    messageEl.className =
                        "h-10 text-2xl font-semibold text-green-500";
                } else {
                    messageEl.textContent = `B·∫°n ƒë√£ l√†m ƒë√∫ng ${correctCount}/${NUM_PROBLEMS} c√¢u. C·ªë l√™n nh√©!`;
                    messageEl.className =
                        "h-10 text-2xl font-semibold text-orange-500";
                }
            }

            // G√°n s·ª± ki·ªán cho c√°c n√∫t v√† b·ªô l·ªçc
            checkBtn.addEventListener("click", checkAnswers);
            newProblemsBtn.addEventListener("click", generateProblems);
            tableSelect.addEventListener("change", generateProblems);

            // ƒê√≥ng modal khi click ra ngo√†i v√πng ch·ªçn
            choiceModal.addEventListener("click", (event) => {
                if (event.target === choiceModal) {
                    choiceModal.classList.add("hidden");
                }
            });

            // T·∫£i b·ªô b√†i to√°n ƒë·∫ßu ti√™n khi trang ƒë∆∞·ª£c m·ªü
            window.onload = generateProblems;
        </script>
    </body>
</html>
